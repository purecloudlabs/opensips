mpath="/usr/local/lib64/opensips/modules"

loadmodule "proto_tcp.so"
loadmodule "proto_udp.so"
loadmodule "tm.so"
loadmodule "sipmsgops.so"
loadmodule "dialog.so"
loadmodule "db_flatstore.so"
loadmodule "rest_client.so"
loadmodule "cfgutils.so"
loadmodule "tracing.so"

modparam("dialog", "default_timeout", 15)

log_level = 3
socket = tcp:127.0.0.1:5060
socket = udp:127.0.0.1:5060

modparam("db_flatstore", "single_file", 1)

modparam("tracing", "backend", "flatstore")
modparam("tracing", "db_url", "flatstore:/work/t")
modparam("tracing", "db_table", "tracing_events")

route {
	if (!has_totag() && is_method("INVITE")) {
		route(process_invite);
	}
	route(relay);
}

route[process_invite] {
	create_dialog();
	route(test_rest_call);
	route(test_delay);
}

route[test_rest_call] {
	rest_post("https://genesys.com/post", '{"callid":"$ci"}', "application/json", $var(rest_body), $var(rest_code));
}

route[test_delay] {
	usleep(1000000);
}

route[relay] {
	t_relay(,"tcp:127.0.0.1:5061");
}
